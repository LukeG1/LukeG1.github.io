<!DOCTYPE html>
<head>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        .click_td {
            width: 40px;
            height: 40px;
        }
        .btn{
            width: 100;
            height: 100%;
            background-color: white;
            border: 0ch;
        }

        .full{
            -webkit-appearance: none;
            border: none;
            width: 32px;
            height: 32px;
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 32px;
            height: 32px;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
        }

    </style>
</head>
<body>
    <span>
        <span style="float: left; border-right: 5px solid #000000; border-bottom: 5px solid #000000; padding-right: 60px; height: 200vh;">
            <h1>Canvas</h1>
            <p>click a cell to set its color</p>
            <div>
                <button onclick="add_col()">Add Column</button>
                <button onclick="add_row()">+Add Row</button>
            </div>
            
            <table id="canvas">
                <tr>
                    <td id="button_1" class="click_td"></td>
                </tr>
            </table>
            <!-- <h1>Regsiter Palette</h1> -->
            <table id="r_tab">
                <tr>
                    <td onclick="update_master_color_reg('R1-name')" style="width: 40px; word-wrap: break-word; vertical-align: top;">
                        <input type="color" id='R1-name' value="#808080">
                        <input type="button" id='R1-type' style="display: block;" onclick="update_color('R1-type')" class="full">
                        <input type="button" id='R1-value' onclick="update_color('R1-value')" class="full">
                        <h1 style="word-wrap: break-word; width: 40px;">R1</h1>
                    </td>
                </tr>
            </table>
            <button onclick="add_reg()">Add Regsiter</button>
            <p style="word-wrap: break-word;width:max-content">use the top cell to select a color for that register.<br>You can preset a value with the 2 buttons below<br>the same way you would on the canvas above</p>

        </span >
        <div>
            <h1>Tools</h1>
            <form method="get" action="esoteric_code_runner_alone.py">
                <button type="submit">Click to download code runner</button>
            </form>
            <h1>Command Palette</h1>
            <p>Click a command to select its color. Hover over a command to see how to use it</p>
            <table>
                <tr><td>Miscellaneous</td></tr>
                <tr>
                    <td id="#d6cf0a" title="[var] [datatype] [value] [var]" style="background-color: #d6cf0a;" onclick="update_master_color('#d6cf0a')" class="click_td">var</td>
                    <td id="#c6a3e6" title="[copy] [location] [destination]" style="background-color: #c6a3e6;" onclick="update_master_color('#c6a3e6')" class="click_td">copy</td>
                    <td id="#1d7499" title="[for] [times to run (int)] [temporary var (int)] ...[what gets repeated]...  [for]" style="background-color: #1d7499;" onclick="update_master_color('#1d7499')" class="click_td">for</td>
                    <td id="#ffb84b" title="[ptyp] [location]" style="background-color: #ffb84b;" onclick="update_master_color('#ffb84b')" class="click_td">ptyp</td>
                    <td id="#9e8520" title="[praw] [location]" style="background-color: #9e8520;" onclick="update_master_color('#9e8520')" class="click_td">praw</td>
                    <td id="#a66d7f" title="[inc] [location]" style="background-color: #a66d7f;" onclick="update_master_color('#a66d7f')" class="click_td">inc</td>
                    <td id="#7a86ff" title="[dec] [location]" style="background-color: #7a86ff;" onclick="update_master_color('#7a86ff')" class="click_td">dec</td>
                    <td id="#ffffff" title="" style="background-color: #ffffff;" onclick="update_master_color('#ffffff')" class="click_td">clear</td>
                </tr>
                <tr><td>Data Types</td></tr>
                <tr>
                    <td id="#ff0000" title="decorator for other methods" style="background-color: #ff0000;" onclick="update_master_color('#ff0000')" class="click_td">int</td>
                    <td id="#ca00f2" title="decorator for other methods" style="background-color: #ca00f2;" onclick="update_master_color('#ca00f2')" class="click_td">str</td>
                    <td id="#ed6b1a" title="decorator for other methods" style="background-color: #ed6b1a;" onclick="update_master_color('#ed6b1a')" class="click_td">bool</td>
                </tr>
                <tr><td>Logic</td></tr>
                <tr>
                    <td id="#e063bd" title="[if] [location (bool)] ...[potiential code]... [if]" style="background-color: #e063bd;" onclick="update_master_color('#e063bd')" class="click_td">if</td>
                    <td id="#32a852" title="[just a posible value]" style="background-color: #32a852;" onclick="update_master_color('#32a852')" class="click_td">true</td>
                    <td id="#d93daf" title="[just a posible value]" style="background-color: #d93daf;" onclick="update_master_color('#d93daf')" class="click_td">fals</td>
                    <td id="#6b1810" title="[not] [location] [destination]" style="background-color: #6b1810;" onclick="update_master_color('#6b1810')" class="click_td">not</td>
                    <td id="#1fe061" title="[eq] [location] [thing 1] [thing 2]" style="background-color: #1fe061;" onclick="update_master_color('#1fe061')" class="click_td">eq</td>
                    <td id="#db4716" title="[lt] [location] [thing 1] [thing 2]" style="background-color: #db4716;" onclick="update_master_color('#db4716')" class="click_td">lt</td>
                    <td id="#7cebc4" title="[lt] [location] [thing 1] [thing 2]" style="background-color: #7cebc4;" onclick="update_master_color('#7cebc4')" class="click_td">gt</td>
                </tr>
                <tr><td>Math</td></tr>
                <tr>
                    <td id="#9d3756" title="[add] [location] [thing 1]...[thing n] [add]" style="background-color: #9d3756;" onclick="update_master_color('#9d3756')" class="click_td">add</td>
                    <td id="#3243fc" title="[sub] [location] [thing 1]...[thing n] [sub]" style="background-color: #3243fc;" onclick="update_master_color('#3243fc')" class="click_td">sub</td>
                    <td id="#3dc9fc" title="[mult] [location] [thing 1]...[thing n] [mult]" style="background-color: #3dc9fc;" onclick="update_master_color('#3dc9fc')" class="click_td">mult</td>
                </tr>
            </table>
            <p>Replace the program and program_memory with your own</p>
            <h2>Enter an integer:</h2>
            <input type="number" id="num_to_hex" value="0" onchange="update_num_as_hex()">
            <h2 id='num_as_hex' onclick="update_color_in('num_as_hex')"></h2>
            <h1>HERE IS THE COMPILED CODE<br>CLICK TO COPY</h1>
            <code id="comp_code" onclick="copy_code()"></code>
        </div>
      </span>
      <script>

            var current_color = "#ffffff";
            var num_rows = 1;
            var num_cols = 1;
            var num_registers = 1;
            var comp_code = "";


            function add_reg(){
                num_registers++

                var regsiter_table = document.getElementById("r_tab")
                var row = regsiter_table.rows[0]
                var cell = row.insertCell(-1)
                var prev_cell = row.cells[0]
                cell.innerHTML = prev_cell.innerHTML.replace(/R1/g, "R"+num_registers.toString(10))
                cell.outerHTML = prev_cell.outerHTML.replace(/R1/g, "R"+num_registers.toString(10))

                //new RegExp("[0-9]")/g


            }


            function renumber_table(){
                var canvas = document.getElementById("canvas")
                var c = 1
                for(var i=0;i<canvas.rows.length;i++){
                    for(var j=0;j<canvas.rows[i].cells.length;j++){
                        var cell = canvas.rows[i].cells[j]
                        cell.id = "button_"+c
                        var target_out = "<td id=\"button_X\" onclick=\"update_color('button_X')\" class=\"click_td\"></td>"
                        var target_out = target_out.replace(/X/g,c.toString(10))
                        cell.outerHTML = target_out

                        c++
                    }
                }
            }

            function add_col(){
                var canvas = document.getElementById("canvas")
                for(var i=0;i<canvas.rows.length;i++){
                    var cell = canvas.rows[i].insertCell(-1)
                    cell = canvas.rows[0].cells[0]
                }
                num_cols++
                renumber_table()
            };

            function add_row(){
                var canvas = document.getElementById("canvas");
                var row = canvas.insertRow(-1);
                for(var i=0;i<num_cols;i++){
                    var cell = row.insertCell(-1);
                    cell = canvas.rows[0].cells[0]
                }
                num_rows++
                renumber_table()
            }


            function update_master_color(color){
                //console.log("ayyye")
                current_color = color;
            };

            function update_master_color_reg(loc){
                var r = document.getElementById(loc)
                current_color = r.value
            }


            function update_color(btn){
                //console.log("ayyye")
                var property = document.getElementById(btn);
                property.style.backgroundColor = current_color

                update_com_code()
            };

            function update_num_as_hex() {
                var x = parseInt(document.getElementById("num_to_hex").value);
                var hexX = x.toString(16);
                hexX = "#"+hexX.padStart(6, '0')
                document.getElementById("num_as_hex").innerHTML = hexX;
                document.getElementById('num_as_hex').style.color = hexX
            }

            function update_color_in(loc){
                current_color = document.getElementById('num_as_hex').innerHTML
            }


            function componentFromStr(numStr, percent) {
                var num = Math.max(0, parseInt(numStr, 10));
                return percent ?
                    Math.floor(255 * Math.min(100, num) / 100) : Math.min(255, num);
            }

            function rgbToHex(rgb) {
                var rgbRegex = /^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/;
                var result, r, g, b, hex = "";
                if ( (result = rgbRegex.exec(rgb)) ) {
                    r = componentFromStr(result[1], result[2]);
                    g = componentFromStr(result[3], result[4]);
                    b = componentFromStr(result[5], result[6]);

                    hex = "0x" + (0x1000000 + (r << 16) + (g << 8) + b).toString(16).slice(1);
                }
                return hex;
            }



            function update_com_code(){
                comp_code = "program = [<br>"
                for(var i=0;i<canvas.rows.length;i++){
                    for(var j=0;j<canvas.rows[i].cells.length;j++){
                        var cell = canvas.rows[i].cells[j]
                        var com = cell.style.backgroundColor
                        if(com != "" && com !="rgb(255, 255, 255)"){
                            var hex = rgbToHex(com)
                            comp_code += "&nbsp;&nbsp;&nbsp;&nbsp;\""
                            comp_code += hex.toLowerCase()
                            comp_code += "\",<br>"
                        }
                        
                    }
                }
                comp_code += "]<br><br>"
                comp_code += "program_memory = {<br>"
                var regsiters = document.getElementById("r_tab").rows[0].cells
                for(var i=0;i<regsiters.length;i++){
                    //console.log(regsiters[i].children[1].value)
                    comp_code += "&nbsp;&nbsp;&nbsp;&nbsp;\""
                    comp_code += regsiters[i].children[0].value.toLowerCase().replace("#","0x")
                    comp_code += "\":["
                    if(regsiters[i].children[1].style.backgroundColor.toLowerCase().replace("#","0x") != ""){
                        comp_code += "\""+rgbToHex(regsiters[i].children[1].style.backgroundColor)+"\""
                        comp_code += ","
                    }
                    if(regsiters[i].children[2].style.backgroundColor.toLowerCase().replace("#","0x") != ""){
                        comp_code += "\""+rgbToHex(regsiters[i].children[2].style.backgroundColor)+"\""
                        comp_code += ","
                    }
                    comp_code += "],<br>"
                }
                comp_code += "}"
                document.getElementById("comp_code").innerHTML = comp_code
            }

            





            function selectText(node) {
                node = document.getElementById(node);

                if (document.body.createTextRange) {
                    const range = document.body.createTextRange();
                    range.moveToElementText(node);
                    range.select();
                } else if (window.getSelection) {
                    const selection = window.getSelection();
                    const range = document.createRange();
                    range.selectNodeContents(node);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    console.warn("Could not select text in node: Unsupported browser.");
                }
            }
            function copy_code() {
                var copyText = document.getElementById("comp_code");
                selectText("comp_code")
                document.execCommand("copy");
            }


            document.addEventListener('DOMContentLoaded', function() {
                for(var i=0;i<5;i++){
                    add_row()
                    add_col()
                    add_reg()
                }
            }, false);

      </script>
</body>
